#!/usr/bin/env bash
set -euo pipefail

# totally-legal-bro: Keep your repo legally chill
# The main CLI entry point

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIB_DIR="${SCRIPT_DIR}/lib"

# Source all library modules
source "${LIB_DIR}/config.sh"
source "${LIB_DIR}/check.sh"
source "${LIB_DIR}/fix.sh"
source "${LIB_DIR}/init.sh"
source "${LIB_DIR}/report.sh"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

function show_usage() {
    cat <<EOF
ðŸ¤™ totally-legal-bro - Keep your repo legally chill

Usage: totally-legal-bro <command> [options]

Commands:
    init        Set up config, git hooks, and CI templates
    check       Validate LICENSE, headers, and dependency licenses
    fix         Auto-fix missing headers and repo files
    report      Generate a detailed compliance report

Options:
    -h, --help  Show this help message

Examples:
    totally-legal-bro init
    totally-legal-bro check
    totally-legal-bro fix
    totally-legal-bro report

For more info, check docs/SPEC.md
EOF
}

# Main command router
COMMAND="${1:-}"

case "${COMMAND}" in
    init)
        cmd_init "${@:2}"
        ;;
    check)
        cmd_check "${@:2}"
        ;;
    fix)
        cmd_fix "${@:2}"
        ;;
    report)
        cmd_report "${@:2}"
        ;;
    -h|--help|help|"")
        show_usage
        exit 0
        ;;
    *)
        echo -e "${RED}Error: Unknown command '${COMMAND}'${NC}" >&2
        echo ""
        show_usage
        exit 1
        ;;
esac
